steps:
  - id: "Rodando docker-compose"
    name: "gcr.io/$PROJECT_ID/docker-compose"
    args: ["-f", "docker-compose.cloudbuild.yml", "up", "-d"]
  - id: "Rodando testes"
    name: "gcr.io/cloud-builders/docker"
    args: ["exec", "-t", "app_go", "go", "test"]
  - id: "Building image"
    name: "gcr.io/cloud-builders/docker"
    args:  ["build","-t","gcr.io/$PROJECT_ID/app-go:$SHORT_SHA","-f","Dockerfile","."]
  - id: "Pushing image"
    name: "gcr.io/cloud-builders/docker"
    args: ["push", "gcr.io/$PROJECT_ID/app-go:$SHORT_SHA"]
